name: trigger_deploy
description: Trigger terraform to deploy the latest image to ECS

inputs:
  image_tag:
    description: 'The image tag to deploy'
    required: true

runs:
  using: "composite"

  steps:
    - name: Repository Dispatch
      uses: peter-evans/repository-dispatch@v3
      with:
        token: ${{ secrets.INFRASTRUCTURE_ACCESS_TOKEN }}
        repository: True-Orbit/infrastructure
        event-type: terraform_apply
        client-payload: '{ "web_service_image_tag": "${{ inputs.image_tag }}" }'